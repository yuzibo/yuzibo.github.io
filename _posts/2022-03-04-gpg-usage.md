---
title: debian GPG使用方式解密
category: tools
layout: post
---
* content
{:toc}

# gpg
如果在开源社区进行交流的话，gpg加密文件是必须需要的。不然，就会造成巨大的乌龙事件。gpg可以用在以下场景：

## 鉴别文件
一般作为鉴别的文件时，可以使用如下命令:

```bash
gpg --import veracrypt_pgp_public_key.asc
gpg --verify veracrypt-1.25.9.sig veracrypt-1.25.9.deb
```
公钥或签名文件通常会以 .sig 或 .asc 为后缀。

## 加密邮件

## 认证登录
ssh key就属于这一种。ssh登录，就是登录的用户把公钥上传到服务器的 ~/.ssh/authorized_keys文件中，然后服务器上的sshd程序使用公钥加密一个 shared key发给用户，用户用私钥解密后得到 shared key,实现认证。

`--export-ssh-keys`可以用gpg得到ssh格式的公钥，并借助 `gpg-agent` 加载私钥.

# 解释
1. key秘钥： 每个key都包含两个部分： Public key和private key。
2. Fingerprint: 指纹是Public key的散列值
```bash
vimer@debian-local:~$ gpg --list-keys tsu.yubo@gmail.com
pub   rsa4096 2022-04-09 [SC]
      E2521CB8175736A97052B2F8954E6A70100598A2  # Fingerprint keys
uid           [ 绝对 ] Bo YU <tsu.yubo@gmail.com>
sub   rsa4096 2022-04-09 [E]
```
这里Fingerprint就是下面的keyid。
3. KeyId就是上面的Fingerprint，用来标识一个Key。这里有两种标识方式：一种long，long就是Fingerprint的后16位字符来表示， short形式就是Fingerprint后8位表示。可以使用下面的命令展示：
```bash
vimer@debian-local:~$ gpg --keyid-format LONG  -k 0xE2521CB8175736A97052B2F8954E6A70100598A2
pub   rsa4096/954E6A70100598A2 2022-04-09 [SC]
      E2521CB8175736A97052B2F8954E6A70100598A2
uid                 [ 绝对 ] Bo YU <tsu.yubo@gmail.com>
sub   rsa4096/66681FECEFF9AC75 2022-04-09 [E]
```
pub后面的`0x95`开头就是long型的keyid。
short型的如下：
```bash
vimer@debian-local:~$ gpg --keyid-format SHORT  -k 0xE2521CB8175736A97052B2F8954E6A70100598A2
pub   rsa4096/100598A2 2022-04-09 [SC]
      E2521CB8175736A97052B2F8954E6A70100598A2
uid         [ 绝对 ] Bo YU <tsu.yubo@gmail.com>
sub   rsa4096/EFF9AC75 2022-04-09 [E]
```
我们一般就是使用LONG型的keyid。
4. UserID: 一个KeyID必须绑定一个USerID，当然，同一个userid可以绑定多个keyid。
5. keying: 秘钥环，保存在`~/gnupg/pubring.kbx`文件中。
```bash
vimer@debian-local:~$ gpg --list-keys
/home/vimer/.gnupg/pubring.kbx
------------------------------
pub   rsa4096 2022-04-09 [SC]
      E2521CB8175736A97052B2F8954E6A70100598A2
uid           [ 绝对 ] Bo YU <tsu.yubo@gmail.com>
sub   rsa4096 2022-04-09 [E]
```
6. gpg config: gpg config文件`~/.gnupg/gpg.conf`,可以作为gpg的配置文件。
7. key server： 可以找一个key server进行upload key文件。
8. keygrip: 
```bash
vimer@debian-local:~$ gpg -k --with-keygrip
/home/vimer/.gnupg/pubring.kbx
------------------------------
pub   rsa4096 2022-04-09 [SC]
      E2521CB8175736A97052B2F8954E6A70100598A2
      Keygrip = DBE2A5E6810C9C3E58E34C385107C9EB6CDDC43B
uid           [ 绝对 ] Bo YU <tsu.yubo@gmail.com>
sub   rsa4096 2022-04-09 [E]
      Keygrip = DBFC45BC6B077D5A7A5A3A58E7BF7F0965C8B058
```
Keygrip与Fingerprint的区别是  他可以唯一区别key。用户是删除masterkey. `gpg --delete-secret-keys [master-keyid]`会删除Master Key的同时问你是否删除Sub key，否则会删除失败。如果只想删除Master  key，则可以只删除`keygrip`.
9. Master 和 Sub keys
    前面已经介绍了master keys。二者之间的联系就是，通过 Binding Signature，master key对sub key进行签名，宣布对Subkey的owner身份；同时 Sub keys也对Masster Key进行签名，声明自己对Master Key的Member关系。

# 试验
因为需要上传Debian package，不得已需要一个GPG key。

请参考[github](https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key)生成gpg key

# 生成 gpg key

```bash
vimer@debian-local:~/git/git-multimail$ gpg --full-generate-key
gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

请选择您要使用的密钥类型：
   (1) RSA 和 RSA （默认）
   (2) DSA 和 Elgamal
   (3) DSA（仅用于签名）
   (4) RSA（仅用于签名）
  (14) Existing key from card
您的选择是？
RSA 密钥的长度应在 1024 位与 4096 位之间。
您想要使用的密钥长度？(3072) 4096 选4096
```


# GPG key id

```bash
gpg --list-secret-keys --keyid-format=long
vimer@debian:~/build_test/jimtcl$ gpg --list-secret-keys --keyid-format=long
gpg: checking the trustdb
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
/home/vimer/.gnupg/pubring.kbx
------------------------------
sec   rsa4096/42A2928E26E21C2 2022-03-04 [SC]
      DD7E8C65E3F5992F52AAA07A452A2928E26E21C2
uid                 [ultimate] vimer <tsu.yubo@gmail.com>
ssb   rsa4096/3338B86BD4FCE12A 2022-03-04 [E]
```
我们这里需要注意的就是`42A2928E26E21C2`，也就是下面需要的id.

# 打印自己的gpg(ASCII 形式)

```bash
gpg --armor --export id
```
目前是一个pc(一个开发环境一个key)，这样的方式有点笨拙。

可以[参考这里](https://superuser.com/questions/466396/how-to-manage-gpg-keys-across-multiple-systems)解决这个问题。

